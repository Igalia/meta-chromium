From 84c3406ee2a88a4fad12487b22a24462f617b167 Mon Sep 17 00:00:00 2001
From: Jose Dapena Paz <jdapena@igalia.com>
Date: Wed, 7 Feb 2024 13:33:01 +0100
Subject: GCC: fix template specialization in non-namespace scope in
 url_loader_factory_builder.h

GCC does not allow template specializations out in any non-namespace
scope.

Bug: 819294
Change-Id: Ia5e6e61801dfcd0c6b5269204fcd513d5064ffc3
---
 .../public/cpp/url_loader_factory_builder.cc  | 14 +++++++++
 .../public/cpp/url_loader_factory_builder.h   | 30 ++++++++-----------
 2 files changed, 26 insertions(+), 18 deletions(-)

diff --git a/services/network/public/cpp/url_loader_factory_builder.cc b/services/network/public/cpp/url_loader_factory_builder.cc
index 26e81de43a5e5..78d7b4e3593b4 100644
--- a/services/network/public/cpp/url_loader_factory_builder.cc
+++ b/services/network/public/cpp/url_loader_factory_builder.cc
@@ -77,4 +77,18 @@ void URLLoaderFactoryBuilder::ConnectTerminal(
                                            std::move(factory_param));
 }
 
+template <>
+scoped_refptr<SharedURLLoaderFactory> URLLoaderFactoryBuilder::WrapAs(
+    mojo::PendingRemote<mojom::URLLoaderFactory> in) {
+  return base::MakeRefCounted<WrapperSharedURLLoaderFactory>(std::move(in));
+}
+
+template <>
+mojo::PendingRemote<mojom::URLLoaderFactory> URLLoaderFactoryBuilder::WrapAs(
+    scoped_refptr<SharedURLLoaderFactory> in) {
+  mojo::PendingRemote<mojom::URLLoaderFactory> remote;
+  in->Clone(remote.InitWithNewPipeAndPassReceiver());
+  return remote;
+}
+
 }  // namespace network
diff --git a/services/network/public/cpp/url_loader_factory_builder.h b/services/network/public/cpp/url_loader_factory_builder.h
index 08aa10e2f03d4..893c27aab96ba 100644
--- a/services/network/public/cpp/url_loader_factory_builder.h
+++ b/services/network/public/cpp/url_loader_factory_builder.h
@@ -120,24 +120,6 @@ class COMPONENT_EXPORT(NETWORK_CPP) URLLoaderFactoryBuilder final {
     return std::move(in);
   }
 
-  // `PendingRemote` -> `SharedURLLoaderFactory`:
-  // Wraps by `WrapperSharedURLLoaderFactory`.
-  template <>
-  scoped_refptr<SharedURLLoaderFactory> WrapAs(
-      mojo::PendingRemote<mojom::URLLoaderFactory> in) {
-    return base::MakeRefCounted<WrapperSharedURLLoaderFactory>(std::move(in));
-  }
-
-  // `SharedURLLoaderFactory` -> `PendingRemote`:
-  // Creates a new pipe and cloning.
-  template <>
-  mojo::PendingRemote<mojom::URLLoaderFactory> WrapAs(
-      scoped_refptr<SharedURLLoaderFactory> in) {
-    mojo::PendingRemote<mojom::URLLoaderFactory> remote;
-    in->Clone(remote.InitWithNewPipeAndPassReceiver());
-    return remote;
-  }
-
   template <typename OutType>
   static OutType WrapAs(mojom::NetworkContext* context,
                         mojom::URLLoaderFactoryParamsPtr factory_param) {
@@ -172,6 +154,18 @@ class COMPONENT_EXPORT(NETWORK_CPP) URLLoaderFactoryBuilder final {
   mojo::PendingReceiver<mojom::URLLoaderFactory> tail_;
 };
 
+// `PendingRemote` -> `SharedURLLoaderFactory`:
+// Wraps by `WrapperSharedURLLoaderFactory`.
+template <>
+COMPONENT_EXPORT(NETWORK_CPP) scoped_refptr<SharedURLLoaderFactory> URLLoaderFactoryBuilder::WrapAs(
+    mojo::PendingRemote<mojom::URLLoaderFactory> in);
+
+// `SharedURLLoaderFactory` -> `PendingRemote`:
+// Creates a new pipe and cloning.
+template <>
+COMPONENT_EXPORT(NETWORK_CPP) mojo::PendingRemote<mojom::URLLoaderFactory> URLLoaderFactoryBuilder::WrapAs(
+    scoped_refptr<SharedURLLoaderFactory> in);
+
 }  // namespace network
 
 #endif  // SERVICES_NETWORK_PUBLIC_CPP_URL_LOADER_FACTORY_BUILDER_H_
-- 
2.40.1

