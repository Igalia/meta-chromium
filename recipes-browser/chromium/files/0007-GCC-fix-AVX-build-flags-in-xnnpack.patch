From add44a2353051d79f3ab5c02c4a9144a736aa150 Mon Sep 17 00:00:00 2001
From: Jose Dapena Paz <jdapena@igalia.com>
Date: Thu, 15 Feb 2024 21:51:38 +0000
Subject: GCC: fix AVX build flags in xnnpack
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Bug: 40565911
Change-Id: If8729e125e3100074b577ac6c90f53506b3b34a0
Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/5296400
Reviewed-by: Sophie Chang <sophiechang@chromium.org>
Commit-Queue: Jos√© Dapena Paz <jdapena@igalia.com>
Cr-Commit-Position: refs/heads/main@{#1261322}
---
 third_party/xnnpack/BUILD.gn | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/third_party/xnnpack/BUILD.gn b/third_party/xnnpack/BUILD.gn
index 85d9c10519196..b4ef74174411f 100644
--- a/third_party/xnnpack/BUILD.gn
+++ b/third_party/xnnpack/BUILD.gn
@@ -396,6 +396,8 @@ if (current_cpu == "x64" || current_cpu == "x86") {
 
   source_set("amalgam_avx512f-avx512cd-avx512bw-avx512dq-avx512vl") {
     cflags = [
+      "-mf16c",
+      "-mfma",
       "-mavx512bw",
       "-mavx512cd",
       "-mavx512dq",
-- 
2.40.1

