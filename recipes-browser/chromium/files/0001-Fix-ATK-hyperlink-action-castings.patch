From 6fe385870629d143c8c737ac061393b8b9aa7025 Mon Sep 17 00:00:00 2001
From: Jose Dapena Paz <jose.dapena@lge.com>
Date: Fri, 17 Nov 2017 18:33:04 +0000
Subject: Fix ATK hyperlink action castings.
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This is a fix for a regression introduced by this jumbo fix:
    commit b1622826665b8e03c6732bb8ecdb16ed736cc358
    Author: Mostyn Bramley-Moore <mostynb@vewd.com>
    Date:   Wed Nov 15 07:05:13 2017 +0000

    [jumbo] avoid ToBrowserAccessibilityAuraLinux redefinition

The change reuses the BrowserAccessibilityAuraLinux AtkAction
casting for BrowserAccessibilityAtkHyperlink. But it is not the
same object, and it will break the hyperlink action support. So
let's provide again a specific casting, but with a name that will
not clash with jumbo build.

Bug: 783447
Change-Id: I319154aadd5aa040a2222d533ca94cb83877068e
Reviewed-on: https://chromium-review.googlesource.com/776778
Reviewed-by: Mostyn Bramley-Moore <mostynb@vewd.com>
Reviewed-by: Dominic Mazzoni <dmazzoni@chromium.org>
Commit-Queue: Jos√© Dapena Paz <jose.dapena@lge.com>
Cr-Commit-Position: refs/heads/master@{#517484}

diff --git a/content/browser/accessibility/browser_accessibility_atk_hyperlink.cc b/content/browser/accessibility/browser_accessibility_atk_hyperlink.cc
index 28632fe22c0a..86205e851da7 100644
--- a/content/browser/accessibility/browser_accessibility_atk_hyperlink.cc
+++ b/content/browser/accessibility/browser_accessibility_atk_hyperlink.cc
@@ -101,12 +101,22 @@ static void browser_accessibility_atk_hyperlink_class_init(
 // AtkAction interface.
 //
 
+static BrowserAccessibilityAuraLinux*
+ToBrowserAccessibilityAuraLinuxFromHyperlinkAction(AtkAction* atk_action) {
+  if (!IS_BROWSER_ACCESSIBILITY_ATK_HYPERLINK(atk_action))
+    return nullptr;
+
+  return ToBrowserAccessibilityAuraLinux(
+      BROWSER_ACCESSIBILITY_ATK_HYPERLINK(atk_action));
+}
+
 static gboolean browser_accessibility_atk_hyperlink_do_action(AtkAction* action,
                                                               gint index) {
   g_return_val_if_fail(ATK_IS_ACTION(action), FALSE);
   g_return_val_if_fail(!index, FALSE);
 
-  BrowserAccessibilityAuraLinux* obj = ToBrowserAccessibilityAuraLinux(action);
+  BrowserAccessibilityAuraLinux* obj =
+      ToBrowserAccessibilityAuraLinuxFromHyperlinkAction(action);
   if (!obj)
     return FALSE;
 
@@ -119,7 +129,8 @@ static gint browser_accessibility_atk_hyperlink_get_n_actions(
     AtkAction* action) {
   g_return_val_if_fail(ATK_IS_ACTION(action), FALSE);
 
-  BrowserAccessibilityAuraLinux* obj = ToBrowserAccessibilityAuraLinux(action);
+  BrowserAccessibilityAuraLinux* obj =
+      ToBrowserAccessibilityAuraLinuxFromHyperlinkAction(action);
   if (!obj)
     return 0;
 
@@ -132,7 +143,8 @@ static const gchar* browser_accessibility_atk_hyperlink_get_description(
   g_return_val_if_fail(ATK_IS_ACTION(action), FALSE);
   g_return_val_if_fail(!index, FALSE);
 
-  BrowserAccessibilityAuraLinux* obj = ToBrowserAccessibilityAuraLinux(action);
+  BrowserAccessibilityAuraLinux* obj =
+      ToBrowserAccessibilityAuraLinuxFromHyperlinkAction(action);
   if (!obj)
     return nullptr;
 
@@ -146,7 +158,8 @@ static const gchar* browser_accessibility_atk_hyperlink_get_keybinding(
   g_return_val_if_fail(ATK_IS_ACTION(action), FALSE);
   g_return_val_if_fail(!index, FALSE);
 
-  BrowserAccessibilityAuraLinux* obj = ToBrowserAccessibilityAuraLinux(action);
+  BrowserAccessibilityAuraLinux* obj =
+      ToBrowserAccessibilityAuraLinuxFromHyperlinkAction(action);
   if (!obj)
     return nullptr;
 
@@ -160,7 +173,7 @@ static const gchar* browser_accessibility_atk_hyperlink_get_name(
   g_return_val_if_fail(!index, FALSE);
 
   BrowserAccessibilityAuraLinux* obj =
-      ToBrowserAccessibilityAuraLinux(atk_action);
+      ToBrowserAccessibilityAuraLinuxFromHyperlinkAction(atk_action);
   if (!obj)
     return nullptr;
 
@@ -179,7 +192,7 @@ static const gchar* browser_accessibility_atk_hyperlink_get_localized_name(
   g_return_val_if_fail(!index, FALSE);
 
   BrowserAccessibilityAuraLinux* obj =
-      ToBrowserAccessibilityAuraLinux(atk_action);
+      ToBrowserAccessibilityAuraLinuxFromHyperlinkAction(atk_action);
   if (!obj)
     return nullptr;
 
-- 
2.14.1

